# Pretty URLs (hide .html) + protect /api/
RewriteEngine On

# Do not touch API routes
RewriteRule ^api/ - [L]

# Maintenance mode: create ".maintenance" in webroot to activate
# - excludes /api/ and Let's Encrypt /.well-known/
RewriteCond %{REQUEST_URI} !^/maintenance\.html$ [NC]
RewriteCond %{REQUEST_URI} !^/\.well-known/ [NC]
RewriteCond %{DOCUMENT_ROOT}/.maintenance -f
RewriteRule ^ - [R=503,L]

ErrorDocument 503 /maintenance.html

# 301: /index.html -> /
RewriteCond %{THE_REQUEST} \s/+(index)\.html[\s?] [NC]
RewriteRule ^index\.html$ / [R=301,L]

# 301: /xxx.html -> /xxx (only direct browser requests)
RewriteCond %{THE_REQUEST} \s/+(.+)\.html[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# Internal rewrite: /xxx -> /xxx.html if .html exists
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+)$ $1.html [L]
